{
  "hash": "8ec92adba5b115732f475c49236de698",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Data Preparation\"\nauthor: \"ReefWhispers Team\"\ndate: \"June 29, 2025\"\ndate-modified: \"last-modified\"\nformat:\n  html:\n    toc: true\n    prefer-html: true\n    navigation:\n      scrollToTop: true\nexecute: \n  echo: true\n  eval: true\n  warning: false\n  freeze: true\n---\n\n\n\n# [1]{style=\"color:#d496d4; background:none;\"} Analytical Toolkit: RStudio\n\nRStudio and Quarto are used as the primary analytical tools for this challenge. The data will be analyzed and visualized using the **tidyverse** suite and advanced network visualization packages to explore the knowledge graph and temporal communication dynamics.\n\n::: callout-note\n# Install [**pacman**](https://cran.r-project.org/web/packages/pacman/index.html){target=\"_blank\"} package\n\nBefore we get started, it is important for us to ensure that the required R packages have been installed. If you have yet to install pacman, install it by typing below in the Console:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\noptions(repos = c(CRAN = \"https://cloud.r-project.org\"))\ninstall.packages(\"pacman\")\n```\n:::\n\n\n:::\n\nWe then load the following R packages using the `pacman::p_load()` function:\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npacman::p_load(tidyverse, tidygraph, ggraph, jsonlite, ggplot2,\n               SmartEDA, lubridate, ggthemes, readr, readxl, knitr, dplyr, visNetwork)\n```\n:::\n\n\n\n# [2]{style=\"color:#d496d4; background:none;\"} Data\n\nThe core dataset is a knowledge graph derived from radio communications intercepted over a two-week period on Oceanus. Each node in the graph represents an entity such as a person, vessel, pseudonym, or organization. Edges represent interactions or co-occurrences in communications. Edge attributes include timestamp, topic, message type, and possible pseudonym use.\n\nSupplementary information from the story given on the Mini Challenge page includes:\n\n-   Entity roles and affiliations (e.g., Green Guardians, Sailor Shift's crew).\n\n-   Known pseudonyms (e.g., “Boss”, “The Lookout”).\n\n-   Historical involvement in illicit activities (e.g., Nadia Conti).\n\nRefer to the data description details in [Appendix A](#appendixa)\n\n## [2.1]{style=\"color:#d496d4; background:none;\"} Load the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngraph_data <- fromJSON(\"data/MC3_graph.json\")\nschema_data <- fromJSON(\"data/MC3_schema.json\")\n```\n:::\n\n\n\n## [2.2]{style=\"color:#d496d4; background:none;\"} Check the Data\n\n### [2.2.1]{style=\"color:#d496d4; background:none;\"} graph_data\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nglimpse(graph_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 5\n $ directed  : logi TRUE\n $ multigraph: logi FALSE\n $ graph     :List of 4\n  ..$ mode        : chr \"static\"\n  ..$ edge_default: Named list()\n  ..$ node_default: Named list()\n  ..$ name        : chr \"VAST_MC3_Knowledge_Graph\"\n $ nodes     :'data.frame':\t1159 obs. of  31 variables:\n  ..$ type             : chr [1:1159] \"Entity\" \"Entity\" \"Entity\" \"Entity\" ...\n  ..$ label            : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ name             : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ sub_type         : chr [1:1159] \"Person\" \"Person\" \"Person\" \"Person\" ...\n  ..$ id               : chr [1:1159] \"Sam\" \"Kelly\" \"Nadia Conti\" \"Elise\" ...\n  ..$ timestamp        : chr [1:1159] NA NA NA NA ...\n  ..$ monitoring_type  : chr [1:1159] NA NA NA NA ...\n  ..$ findings         : chr [1:1159] NA NA NA NA ...\n  ..$ content          : chr [1:1159] NA NA NA NA ...\n  ..$ assessment_type  : chr [1:1159] NA NA NA NA ...\n  ..$ results          : chr [1:1159] NA NA NA NA ...\n  ..$ movement_type    : chr [1:1159] NA NA NA NA ...\n  ..$ destination      : chr [1:1159] NA NA NA NA ...\n  ..$ enforcement_type : chr [1:1159] NA NA NA NA ...\n  ..$ outcome          : chr [1:1159] NA NA NA NA ...\n  ..$ activity_type    : chr [1:1159] NA NA NA NA ...\n  ..$ participants     : int [1:1159] NA NA NA NA NA NA NA NA NA NA ...\n  ..$ thing_collected  :'data.frame':\t1159 obs. of  2 variables:\n  .. ..$ type: chr [1:1159] NA NA NA NA ...\n  .. ..$ name: chr [1:1159] NA NA NA NA ...\n  ..$ reference        : chr [1:1159] NA NA NA NA ...\n  ..$ date             : chr [1:1159] NA NA NA NA ...\n  ..$ time             : chr [1:1159] NA NA NA NA ...\n  ..$ friendship_type  : chr [1:1159] NA NA NA NA ...\n  ..$ permission_type  : chr [1:1159] NA NA NA NA ...\n  ..$ start_date       : chr [1:1159] NA NA NA NA ...\n  ..$ end_date         : chr [1:1159] NA NA NA NA ...\n  ..$ report_type      : chr [1:1159] NA NA NA NA ...\n  ..$ submission_date  : chr [1:1159] NA NA NA NA ...\n  ..$ jurisdiction_type: chr [1:1159] NA NA NA NA ...\n  ..$ authority_level  : chr [1:1159] NA NA NA NA ...\n  ..$ coordination_type: chr [1:1159] NA NA NA NA ...\n  ..$ operational_role : chr [1:1159] NA NA NA NA ...\n $ edges     :'data.frame':\t3226 obs. of  5 variables:\n  ..$ id         : chr [1:3226] \"2\" \"3\" \"5\" \"3013\" ...\n  ..$ is_inferred: logi [1:3226] TRUE FALSE TRUE TRUE TRUE TRUE ...\n  ..$ source     : chr [1:3226] \"Sam\" \"Sam\" \"Sam\" \"Sam\" ...\n  ..$ target     : chr [1:3226] \"Relationship_Suspicious_217\" \"Event_Communication_370\" \"Event_Assessment_600\" \"Relationship_Colleagues_430\" ...\n  ..$ type       : chr [1:3226] NA \"sent\" NA NA ...\n```\n\n\n:::\n:::\n\n\n\n### [4.2.2]{style=\"color:#d496d4; background:none;\"} schema_data\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nglimpse(schema_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 1\n $ schema:List of 2\n  ..$ nodes:List of 3\n  .. ..$ Entity      :List of 2\n  .. ..$ Event       :List of 2\n  .. ..$ Relationship:List of 2\n  ..$ edges:List of 3\n  .. ..$ description: chr \"Connections between nodes in the knowledge graph\"\n  .. ..$ is_inferred: chr \"bool\"\n  .. ..$ types      :'data.frame':\t6 obs. of  5 variables:\n```\n\n\n:::\n:::\n\n\n\n::: {.nursebox .nurse data-latex=\"nurse\"}\n#### **Observation** {#glimpse .no-top-padding}\n\n-   Each data set are already split to nodes and edges thus we will extract the edges and nodes to their own tables.\n-   There are a lot of NA values because only certain types have certain information. For example type = \"events\" and sub_type = \"Communications\" will have timestamp and content.\n-   Since the focus is recorded intercepted radio communications over the last two weeks, we will also focus on Communications records.\n-   We also need to clean and convert some of the data types (e.g Convert timestamp from chr to datetime format)\n\nLet's explore each edges and nodes!\n:::\n\n## [2.3]{style=\"color:#d496d4; background:none;\"} Extracting the edges and nodes tables\n\nFirst we need to extract the nodes and links tibble data frames using `as_tibble()` of **tibble** package package into two separate tibble dataframes called *nodes_tbl* and *edges_tbl* respectively.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnodes_tbl <- as_tibble(graph_data$nodes)\nedges_tbl <- as_tibble(graph_data$edges)\n```\n:::\n\n\n\n### [2.3.1]{style=\"color:#d496d4; background:none;\"} Initial EDA {#EDA}\n\n#### [2.3.1.1]{style=\"color:#d496d4; background:none;\"} Check how many distinct nodes\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntable(nodes_tbl$type)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n      Entity        Event Relationship \n          72          802          285 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nkable(head(nodes_tbl))\n```\n\n::: {.cell-output-display}\n\n\n|type   |label          |name           |sub_type |id             |timestamp |monitoring_type |findings |content |assessment_type |results |movement_type |destination |enforcement_type |outcome |activity_type | participants|thing_collected |reference |date |time |friendship_type |permission_type |start_date |end_date |report_type |submission_date |jurisdiction_type |authority_level |coordination_type |operational_role |\n|:------|:--------------|:--------------|:--------|:--------------|:---------|:---------------|:--------|:-------|:---------------|:-------|:-------------|:-----------|:----------------|:-------|:-------------|------------:|:---------------|:---------|:----|:----|:---------------|:---------------|:----------|:--------|:-----------|:---------------|:-----------------|:---------------|:-----------------|:----------------|\n|Entity |Sam            |Sam            |Person   |Sam            |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Entity |Kelly          |Kelly          |Person   |Kelly          |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Entity |Nadia Conti    |Nadia Conti    |Person   |Nadia Conti    |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Entity |Elise          |Elise          |Person   |Elise          |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Entity |Liam Thorne    |Liam Thorne    |Person   |Liam Thorne    |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Entity |Samantha Blake |Samantha Blake |Person   |Samantha Blake |NA        |NA              |NA       |NA      |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n\n\n:::\n:::\n\n\n\n#### [2.3.1.2]{style=\"color:#d496d4; background:none;\"} Check how many distinct edges\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntable(edges_tbl$type)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nevidence_for     received         sent \n        1036          584          584 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nkable(head(edges_tbl))\n```\n\n::: {.cell-output-display}\n\n\n|id   |is_inferred |source |target                      |type |\n|:----|:-----------|:------|:---------------------------|:----|\n|2    |TRUE        |Sam    |Relationship_Suspicious_217 |NA   |\n|3    |FALSE       |Sam    |Event_Communication_370     |sent |\n|5    |TRUE        |Sam    |Event_Assessment_600        |NA   |\n|3013 |TRUE        |Sam    |Relationship_Colleagues_430 |NA   |\n|NA   |TRUE        |Sam    |Relationship_Friends_272    |NA   |\n|NA   |TRUE        |Sam    |Relationship_Colleagues_215 |NA   |\n\n\n:::\n:::\n\n\n\n#### [2.3.1.3]{style=\"color:#d496d4; background:none;\"} Explore frequency distribution of nodes_tbl\n\nIn the code chunk below, `ExpCatViz()` of SmartEDA package is used to reveal the frequency distribution of all categorical fields in *nodes_tbl* dataframe.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nExpCatViz(nodes_tbl, col = \"lightblue\",margin=2,Page = c(7,2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`0`\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](dataprep_files/figure-html/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\n::: {.nursebox .nurse data-latex=\"nurse\"}\n#### **Observation** {#obsv1 .no-top-padding}\n\n-   Node type is dominated Events (69%) followed by Relationship (25%) and Entity (6%).\n-   We need to convert some of the data types for date and time from chr to datetime format.\n-   High Missing Values Across Most Fields. Fields like reference, authority_level, and report_type are nearly all NA.\n-   Fields like monitoring_type, assessment_type, movement_type, etc. also show very sparse use. Which supports the earlier [glimpse()](#glimpse) finding where most attribute fields are only relevant to certain subtypes (e.g. type = \"events\" and sub_type = \"Communications\" will have timestamp and content but other type and sub_types doesn't have these information). We need to conditionally filter or visualize based on both type and sub_type to avoid misleading analysis. For example, don’t rely on type: assessment_type unless sub_type == \"Assessment\".\n:::\n\n#### [2.3.1.4]{style=\"color:#d496d4; background:none;\"} Explore frequency distribution of edges_tbl\n\nNow we will reveal the frequency distribution of all categorical fields in *edges_tbl* dataframe.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nExpCatViz(data=edges_tbl,\n          col=\"lightblue\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](dataprep_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n\n::: {.nursebox .nurse data-latex=\"nurse\"}\n#### **Observation** {.no-top-padding}\n\n-   A large proportion (32%) of edges have missing/undefined type values (NA). But as we've discovered from the earlier findings in earlier [SmartEDA of nodes_tbl](#obsv1) and [glimpse()](#glimpse), we know that only certain type and sub_type have all information.\n\n-   Significant portion of edges are evidence_for (32%), suggests more evidential or contextual links. Possibly connecting events or documents to people, vessels, or actions.\n\n-   Communication events (e.g., who sent/received messages) only make up 18% each of the dataset means that communication-specific analyses should filter only these types, excluding NA and evidence_for.\n\n-   These observations support the earlier suggestion in glimpse() to filter only communication related data for our visualisation later on.\n:::\n\n## [2.4]{style=\"color:#d496d4; background:none;\"} Data Preparation {#dataprep}\n\nAfter the initial [EDA](#EDA) done in the previous chapter, we will performs the following data cleaning and data wrangling tasks:\n\n-   Extract type = \"Event\", and sub_type = \"communication\" events since we will be focusing on intercepted communications.\n-   Convert timestamp from chr to datetime format.\n-   Extract sender and receiver links.\n-   Separate senders and receivers.\n-   Join sender-receiver pairs.\n-   Join with communication details.\n-   Join to get sender/receiver labels.\n-   Join to get entity type from sub_type.\n-   Save the result for further analysis and visualisation usage.\n\n### [2.4.1]{style=\"color:#d496d4; background:none;\"} Extract communication events with timestamps\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_events <- nodes_tbl %>%\n  filter(type == \"Event\", sub_type == \"Communication\")\n\nkable(head(comm_events))\n```\n\n::: {.cell-output-display}\n\n\n|type  |label         |name |sub_type      |id                    |timestamp           |monitoring_type |findings |content                                                                                                                                                                                                                                                         |assessment_type |results |movement_type |destination |enforcement_type |outcome |activity_type | participants|thing_collected |reference |date |time |friendship_type |permission_type |start_date |end_date |report_type |submission_date |jurisdiction_type |authority_level |coordination_type |operational_role |\n|:-----|:-------------|:----|:-------------|:---------------------|:-------------------|:---------------|:--------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------|:-------|:-------------|:-----------|:----------------|:-------|:-------------|------------:|:---------------|:---------|:----|:----|:---------------|:---------------|:----------|:--------|:-----------|:---------------|:-----------------|:---------------|:-----------------|:----------------|\n|Event |Communication |NA   |Communication |Event_Communication_1 |2040-10-01 08:09:00 |NA              |NA       |Hey The Intern, it's The Lookout! Just spotted a pod of dolphins near the eastern point this morning. They were so playful! If you're free this weekend, the migratory birds are starting to arrive too. Let me know if you want to join for some birdwatching! |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Event |Communication |NA   |Communication |Event_Communication_2 |2040-10-01 08:10:00 |NA              |NA       |Hey The Lookout, The Intern here! I'd absolutely love to join you for birdwatching this weekend! Those dolphins sound amazing. What time were you thinking? I'll bring my new binoculars that Mrs. Money helped me pick out.                                    |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Event |Communication |NA   |Communication |Event_Communication_3 |2040-10-01 08:13:00 |NA              |NA       |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                       |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Event |Communication |NA   |Communication |Event_Communication_5 |2040-10-01 08:16:00 |NA              |NA       |Mrs. Money, it's The Intern. Just checking in to see what tasks you need help with today. Also, I'll be birdwatching with The Lookout this weekend. Should I reschedule if you need me for anything?                                                            |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Event |Communication |NA   |Communication |Event_Communication_6 |2040-10-01 08:19:00 |NA              |NA       |Boss, it's Mrs. Money. I've reviewed our operational funding for the upcoming projects. Need to discuss allocation priorities before our meeting with The Middleman next week. Are you available tomorrow afternoon?                                            |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n|Event |Communication |NA   |Communication |Event_Communication_7 |2040-10-01 08:21:00 |NA              |NA       |Mrs. Money, this is Boss. I'm available tomorrow at 3 PM to discuss funding allocations. Bring the updated projections for our tourism ventures. We need to ensure everything looks legitimate before meeting The Middleman next week.                          |NA              |NA      |NA            |NA          |NA               |NA      |NA            |           NA|NA              |NA        |NA   |NA   |NA              |NA              |NA         |NA       |NA          |NA              |NA                |NA              |NA                |NA               |\n\n\n:::\n:::\n\n\n\n### [2.4.2]{style=\"color:#d496d4; background:none;\"} Extract necessary fields\n\nWe'll use `id`, `timestamp` and `content`\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_events <- comm_events %>%\n  select(id, timestamp = timestamp, content = content)\n\nkable(head(comm_events))\n```\n\n::: {.cell-output-display}\n\n\n|id                    |timestamp           |content                                                                                                                                                                                                                                                         |\n|:---------------------|:-------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|Event_Communication_1 |2040-10-01 08:09:00 |Hey The Intern, it's The Lookout! Just spotted a pod of dolphins near the eastern point this morning. They were so playful! If you're free this weekend, the migratory birds are starting to arrive too. Let me know if you want to join for some birdwatching! |\n|Event_Communication_2 |2040-10-01 08:10:00 |Hey The Lookout, The Intern here! I'd absolutely love to join you for birdwatching this weekend! Those dolphins sound amazing. What time were you thinking? I'll bring my new binoculars that Mrs. Money helped me pick out.                                    |\n|Event_Communication_3 |2040-10-01 08:13:00 |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                       |\n|Event_Communication_5 |2040-10-01 08:16:00 |Mrs. Money, it's The Intern. Just checking in to see what tasks you need help with today. Also, I'll be birdwatching with The Lookout this weekend. Should I reschedule if you need me for anything?                                                            |\n|Event_Communication_6 |2040-10-01 08:19:00 |Boss, it's Mrs. Money. I've reviewed our operational funding for the upcoming projects. Need to discuss allocation priorities before our meeting with The Middleman next week. Are you available tomorrow afternoon?                                            |\n|Event_Communication_7 |2040-10-01 08:21:00 |Mrs. Money, this is Boss. I'm available tomorrow at 3 PM to discuss funding allocations. Bring the updated projections for our tourism ventures. We need to ensure everything looks legitimate before meeting The Middleman next week.                          |\n\n\n:::\n:::\n\n\n\n### [2.4.3]{style=\"color:#d496d4; background:none;\"} Convert timestamp from chr to datetime format\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_events <- comm_events %>%\n  mutate(timestamp = ymd_hms(timestamp))\n\nkable(head(comm_events))\n```\n\n::: {.cell-output-display}\n\n\n|id                    |timestamp           |content                                                                                                                                                                                                                                                         |\n|:---------------------|:-------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|Event_Communication_1 |2040-10-01 08:09:00 |Hey The Intern, it's The Lookout! Just spotted a pod of dolphins near the eastern point this morning. They were so playful! If you're free this weekend, the migratory birds are starting to arrive too. Let me know if you want to join for some birdwatching! |\n|Event_Communication_2 |2040-10-01 08:10:00 |Hey The Lookout, The Intern here! I'd absolutely love to join you for birdwatching this weekend! Those dolphins sound amazing. What time were you thinking? I'll bring my new binoculars that Mrs. Money helped me pick out.                                    |\n|Event_Communication_3 |2040-10-01 08:13:00 |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                       |\n|Event_Communication_5 |2040-10-01 08:16:00 |Mrs. Money, it's The Intern. Just checking in to see what tasks you need help with today. Also, I'll be birdwatching with The Lookout this weekend. Should I reschedule if you need me for anything?                                                            |\n|Event_Communication_6 |2040-10-01 08:19:00 |Boss, it's Mrs. Money. I've reviewed our operational funding for the upcoming projects. Need to discuss allocation priorities before our meeting with The Middleman next week. Are you available tomorrow afternoon?                                            |\n|Event_Communication_7 |2040-10-01 08:21:00 |Mrs. Money, this is Boss. I'm available tomorrow at 3 PM to discuss funding allocations. Bring the updated projections for our tourism ventures. We need to ensure everything looks legitimate before meeting The Middleman next week.                          |\n\n\n:::\n:::\n\n\n\n### [2.4.3]{style=\"color:#d496d4; background:none;\"} Filter edges for sender and receiver\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_edges <- edges_tbl %>%\n  filter(type %in% c(\"sent\", \"received\")) %>%\n  select(source, target, type)\n\nkable(head(comm_edges))\n```\n\n::: {.cell-output-display}\n\n\n|source      |target                  |type |\n|:-----------|:-----------------------|:----|\n|Sam         |Event_Communication_370 |sent |\n|Kelly       |Event_Communication_3   |sent |\n|Kelly       |Event_Communication_443 |sent |\n|Nadia Conti |Event_Communication_331 |sent |\n|Nadia Conti |Event_Communication_334 |sent |\n|Nadia Conti |Event_Communication_529 |sent |\n\n\n:::\n:::\n\n\n\n### [2.4.4]{style=\"color:#d496d4; background:none;\"} Separate and rename\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsenders <- comm_edges %>%\n  filter(type == \"sent\") %>%\n  rename(sender = source, message_id = target)\n\nreceivers <- comm_edges %>%\n  filter(type == \"received\") %>%\n  rename(receiver = target, message_id = source)\n```\n:::\n\n\n\n### [2.4.5]{style=\"color:#d496d4; background:none;\"} Join sender and receiver info\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_pairs <- inner_join(senders, receivers, by = \"message_id\")\n\nkable(head(comm_pairs))\n```\n\n::: {.cell-output-display}\n\n\n|sender      |message_id              |type.x |receiver             |type.y   |\n|:-----------|:-----------------------|:------|:--------------------|:--------|\n|Sam         |Event_Communication_370 |sent   |Kelly                |received |\n|Kelly       |Event_Communication_3   |sent   |Sam                  |received |\n|Kelly       |Event_Communication_443 |sent   |Sam                  |received |\n|Nadia Conti |Event_Communication_331 |sent   |Haacklee Harbor      |received |\n|Nadia Conti |Event_Communication_334 |sent   |Oceanus City Council |received |\n|Nadia Conti |Event_Communication_529 |sent   |Liam Thorne          |received |\n\n\n:::\n:::\n\n\n\n### [2.4.6]{style=\"color:#d496d4; background:none;\"} Combine with communication details\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_full <- comm_pairs %>%\n  left_join(comm_events, by = c(\"message_id\" = \"id\"))\n\nkable(head(comm_full))\n```\n\n::: {.cell-output-display}\n\n\n|sender      |message_id              |type.x |receiver             |type.y   |timestamp           |content                                                                                                                                                                                                                                                                                    |\n|:-----------|:-----------------------|:------|:--------------------|:--------|:-------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n|Sam         |Event_Communication_370 |sent   |Kelly                |received |2040-10-05 10:48:00 |Hey Kelly, it's Sam. This permit approval seems fishy. Could you get details on who signed off on it while you're at the harbor? I need to understand these 'special access corridors' before my meeting with Elise tomorrow.                                                              |\n|Kelly       |Event_Communication_3   |sent   |Sam                  |received |2040-10-01 08:13:00 |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                                                  |\n|Kelly       |Event_Communication_443 |sent   |Sam                  |received |2040-10-07 08:11:00 |Hey Sam, it's Kelly! Got some photos of those crates - definitely marked 'fragile' and 'handle with care.' Neptune's crew is being super secretive. They're using special loading equipment I've never seen before. See you at 7 for birdwatching!                                         |\n|Nadia Conti |Event_Communication_331 |sent   |Haacklee Harbor      |received |2040-10-05 09:45:00 |Haacklee Harbor, this is Nadia Conti. I need to cancel the special access corridor arrangements for Nemo Reef immediately. Plans have changed due to unforeseen circumstances. Destroy all related documentation. I'll contact you when we're ready to proceed with alternative locations. |\n|Nadia Conti |Event_Communication_334 |sent   |Oceanus City Council |received |2040-10-05 09:49:00 |This is Nadia Conti. My cancellation was due to scheduling conflicts with our tourism development initiatives. I wasn't aware of any permit approvals. I'll submit revised documentation for alternative sustainable tourism proposals next week.                                          |\n|Nadia Conti |Event_Communication_529 |sent   |Liam Thorne          |received |2040-10-08 08:18:00 |Liam, Nadia here. Need your services urgently. Investigation brewing around Nemo Reef permits. Double your usual fee if you can ensure Harbor Master remains cooperative through next week. Meet at the usual place tomorrow, 10PM.                                                        |\n\n\n:::\n:::\n\n\n\n### [2.4.7]{style=\"color:#d496d4; background:none;\"} Join entity labels for sender and receiver\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nentity_labels <- nodes_tbl %>%\n  filter(type == \"Entity\") %>%\n  select(id, label, sub_type)\n\nkable(head(entity_labels))\n```\n\n::: {.cell-output-display}\n\n\n|id             |label          |sub_type |\n|:--------------|:--------------|:--------|\n|Sam            |Sam            |Person   |\n|Kelly          |Kelly          |Person   |\n|Nadia Conti    |Nadia Conti    |Person   |\n|Elise          |Elise          |Person   |\n|Liam Thorne    |Liam Thorne    |Person   |\n|Samantha Blake |Samantha Blake |Person   |\n\n\n:::\n:::\n\n\n\n### [2.4.7]{style=\"color:#d496d4; background:none;\"} Combine everything\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomm_full <- comm_full %>%\n  left_join(entity_labels, by = c(\"sender\" = \"id\")) %>%\n  rename(sender_label = label, sender_type = sub_type) %>%\n  left_join(entity_labels, by = c(\"receiver\" = \"id\")) %>%\n  rename(receiver_label = label, receiver_type = sub_type)\n\nkable(head(comm_full))\n```\n\n::: {.cell-output-display}\n\n\n|sender      |message_id              |type.x |receiver             |type.y   |timestamp           |content                                                                                                                                                                                                                                                                                    |sender_label |sender_type |receiver_label       |receiver_type |\n|:-----------|:-----------------------|:------|:--------------------|:--------|:-------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------|:-----------|:--------------------|:-------------|\n|Sam         |Event_Communication_370 |sent   |Kelly                |received |2040-10-05 10:48:00 |Hey Kelly, it's Sam. This permit approval seems fishy. Could you get details on who signed off on it while you're at the harbor? I need to understand these 'special access corridors' before my meeting with Elise tomorrow.                                                              |Sam          |Person      |Kelly                |Person        |\n|Kelly       |Event_Communication_3   |sent   |Sam                  |received |2040-10-01 08:13:00 |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                                                  |Kelly        |Person      |Sam                  |Person        |\n|Kelly       |Event_Communication_443 |sent   |Sam                  |received |2040-10-07 08:11:00 |Hey Sam, it's Kelly! Got some photos of those crates - definitely marked 'fragile' and 'handle with care.' Neptune's crew is being super secretive. They're using special loading equipment I've never seen before. See you at 7 for birdwatching!                                         |Kelly        |Person      |Sam                  |Person        |\n|Nadia Conti |Event_Communication_331 |sent   |Haacklee Harbor      |received |2040-10-05 09:45:00 |Haacklee Harbor, this is Nadia Conti. I need to cancel the special access corridor arrangements for Nemo Reef immediately. Plans have changed due to unforeseen circumstances. Destroy all related documentation. I'll contact you when we're ready to proceed with alternative locations. |Nadia Conti  |Person      |Haacklee Harbor      |Location      |\n|Nadia Conti |Event_Communication_334 |sent   |Oceanus City Council |received |2040-10-05 09:49:00 |This is Nadia Conti. My cancellation was due to scheduling conflicts with our tourism development initiatives. I wasn't aware of any permit approvals. I'll submit revised documentation for alternative sustainable tourism proposals next week.                                          |Nadia Conti  |Person      |Oceanus City Council |Organization  |\n|Nadia Conti |Event_Communication_529 |sent   |Liam Thorne          |received |2040-10-08 08:18:00 |Liam, Nadia here. Need your services urgently. Investigation brewing around Nemo Reef permits. Double your usual fee if you can ensure Harbor Master remains cooperative through next week. Meet at the usual place tomorrow, 10PM.                                                        |Nadia Conti  |Person      |Liam Thorne          |Person        |\n\n\n:::\n:::\n\n\n\n### [2.4.8]{style=\"color:#d496d4; background:none;\"} Derive weekday and hour of the day fields\n\nStep 1: Deriving *weekday* and *hour of day* fields\n\nCreate two new fields namely *weekday* and *hour*. In this step, we will write a function to perform the task.\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nmake_hr_wkday <- function(timestamp) {\n  real_times <- ymd_hms(timestamp)\n  dt <- data.table(\n    weekday = weekdays(real_times),\n    hour = hour(real_times)\n  )\n  return(dt)\n}\n```\n:::\n\n\n\nStep 2: Deriving the communication tibble data frame\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nweekday_levels <- c(\"Sunday\", \"Saturday\", \"Friday\", \n                    \"Thursday\",\"Wednesday\",\"Tuesday\",  \"Monday\")\n\ncomm_full <- comm_full %>%\n  mutate(\n    date = as.Date(timestamp),\n    weekday = factor(weekdays(timestamp), levels = weekday_levels),\n    hour = factor(hour(timestamp), levels = 0:23),\n    week = isoweek(timestamp),\n    week_label = case_when(\n      isoweek(timestamp) == min(isoweek(timestamp)) ~ \"Week 1\",\n      isoweek(timestamp) == max(isoweek(timestamp)) ~ \"Week 2\",\n      TRUE ~ \"Other\")\n  )\n```\n:::\n\n\n\n::: callout-note\nBeside extracting the necessary data into *attacks* data frame, `mutate()` of **dplyr** package is used to convert *weekday* and *hour* fields into **factor** so they'll be ordered when plotting\n:::\n\nTable below shows the tidy tibble table after processing.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(head(comm_full))\n```\n\n::: {.cell-output-display}\n\n\n|sender      |message_id              |type.x |receiver             |type.y   |timestamp           |content                                                                                                                                                                                                                                                                                    |sender_label |sender_type |receiver_label       |receiver_type |date       |weekday |hour | week|week_label |\n|:-----------|:-----------------------|:------|:--------------------|:--------|:-------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------|:-----------|:--------------------|:-------------|:----------|:-------|:----|----:|:----------|\n|Sam         |Event_Communication_370 |sent   |Kelly                |received |2040-10-05 10:48:00 |Hey Kelly, it's Sam. This permit approval seems fishy. Could you get details on who signed off on it while you're at the harbor? I need to understand these 'special access corridors' before my meeting with Elise tomorrow.                                                              |Sam          |Person      |Kelly                |Person        |2040-10-05 |Friday  |10   |   40|Week 1     |\n|Kelly       |Event_Communication_3   |sent   |Sam                  |received |2040-10-01 08:13:00 |Sam, it's Kelly! Let's meet at Sunrise Point at 7 AM for birdwatching. Bring your new binoculars and some water. I've heard there might be some rare shorebirds passing through this weekend. Can't wait!                                                                                  |Kelly        |Person      |Sam                  |Person        |2040-10-01 |Monday  |8    |   40|Week 1     |\n|Kelly       |Event_Communication_443 |sent   |Sam                  |received |2040-10-07 08:11:00 |Hey Sam, it's Kelly! Got some photos of those crates - definitely marked 'fragile' and 'handle with care.' Neptune's crew is being super secretive. They're using special loading equipment I've never seen before. See you at 7 for birdwatching!                                         |Kelly        |Person      |Sam                  |Person        |2040-10-07 |Sunday  |8    |   40|Week 1     |\n|Nadia Conti |Event_Communication_331 |sent   |Haacklee Harbor      |received |2040-10-05 09:45:00 |Haacklee Harbor, this is Nadia Conti. I need to cancel the special access corridor arrangements for Nemo Reef immediately. Plans have changed due to unforeseen circumstances. Destroy all related documentation. I'll contact you when we're ready to proceed with alternative locations. |Nadia Conti  |Person      |Haacklee Harbor      |Location      |2040-10-05 |Friday  |9    |   40|Week 1     |\n|Nadia Conti |Event_Communication_334 |sent   |Oceanus City Council |received |2040-10-05 09:49:00 |This is Nadia Conti. My cancellation was due to scheduling conflicts with our tourism development initiatives. I wasn't aware of any permit approvals. I'll submit revised documentation for alternative sustainable tourism proposals next week.                                          |Nadia Conti  |Person      |Oceanus City Council |Organization  |2040-10-05 |Friday  |9    |   40|Week 1     |\n|Nadia Conti |Event_Communication_529 |sent   |Liam Thorne          |received |2040-10-08 08:18:00 |Liam, Nadia here. Need your services urgently. Investigation brewing around Nemo Reef permits. Double your usual fee if you can ensure Harbor Master remains cooperative through next week. Meet at the usual place tomorrow, 10PM.                                                        |Nadia Conti  |Person      |Liam Thorne          |Person        |2040-10-08 |Monday  |8    |   41|Week 2     |\n\n\n:::\n:::\n\n\n\n### [2.4.9]{style=\"color:#d496d4; background:none;\"} Save to CSV\n\nFor the purpose of this project, we will extract out to CSV so the rest of the group can work with this cleaned data!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_csv(comm_full, \"data/communications_full.csv\")\n```\n:::",
    "supporting": [
      "dataprep_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}